<nz-layout>
  <nz-content>
    <nz-breadcrumb class="breadcrumb">
      <nz-breadcrumb-item>
        <a [routerLink]="['/home']">Home</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/workflows']">Referral</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>

    <div class="inner-content">
      <div nz-row [nzGutter]="16" style="margin-bottom: 16px; padding: 16px">
        <!-- Date Range Filter -->
        <div nz-col [nzSpan]="6">
          <nz-date-picker
            nzPlaceHolder="Start Date"
            [(ngModel)]="startDate"
            (ngModelChange)="onDateFilterChange()"
          ></nz-date-picker>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-date-picker
            nzPlaceHolder="End Date"
            [(ngModel)]="endDate"
            (ngModelChange)="onDateFilterChange()"
          ></nz-date-picker>
        </div>

        <!-- Health Facility Filter -->
        <div nz-col [nzSpan]="6">
          <nz-select
            nzPlaceHolder="Health Facility From"
            [(ngModel)]="selectedFacilityFrom"
            (ngModelChange)="onFacilityFilterChange()"
          >
            <nz-option
              *ngFor="let facility of facilities"
              [nzValue]="facility.id"
              [nzLabel]="facility.name"
            ></nz-option>
          </nz-select>
        </div>
        <div nz-col [nzSpan]="6">
          <nz-select
            nzPlaceHolder="Health Facility To"
            [(ngModel)]="selectedFacilityTo"
            (ngModelChange)="onFacilityFilterChange()"
          >
            <nz-option
              *ngFor="let facility of facilities"
              [nzValue]="facility.id"
              [nzLabel]="facility.name"
            ></nz-option>
          </nz-select>
        </div>
      </div>

      <div nz-row>
        <div style="padding: 16px; width: 100%">
          <div style="margin-bottom: 16px">
            <search-bar
              [labelText]="'Search Referral:'"
              (inputSearchValue)="onDatasetsSearchInputTyping($event)"
            ></search-bar>
          </div>

          <nz-table
            nzShowSizeChanger
            [nzData]="listOfHduClients"
            [nzFrontPagination]="false"
            [nzLoading]="loading"
            [nzTotal]="total"
            [nzPageSize]="pageSize"
            [nzPageIndex]="pageIndex"
            (nzQueryParams)="onQueryParamsChange($event)"
          >
            <thead>
              <tr>
                <th>SN</th>
                <th>Client ID</th>
                <th>First name</th>
                <th>Middle name</th>
                <th>Surname</th>
                <th>Gender</th>
                <th>Phone number</th>
                <th>Referral Date</th>
                <th>Reason</th>
                <th>Referral No</th>
                <th>Referring from</th>
                <th>Referring to</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              @for (data of listOfHduClients; track data.demographicDetails.fname; let i = $index) {
              <tr>
                <td>{{ pageIndex === 1 ? i + 1 : (pageIndex - 1) * 10 + i + 1 }}</td>
                <td>
                  <span style="color: #1890ff">{{ data.demographicDetails.clientID }}</span>
                </td>
                <td>{{ data.demographicDetails.fname }}</td>
                <td>{{ data.demographicDetails.mname }}</td>
                <td>{{ data.demographicDetails.surname }}</td>
                <td>{{ data.demographicDetails.gender }}</td>
                <td>{{ data.demographicDetails.phoneNumbers }}</td>
                <td>{{ data?.referralDetails?.referralDate || '' }}</td>
                <td>{{ data?.referralDetails?.reason || '' }}</td>
                <td>{{ data?.referralDetails?.referralNumber || '' }}</td>
                <td>{{ data?.facilityDetails?.name || '' }}</td>
                <td>{{ data?.referralDetails?.hfrCode || '' }}</td>
                <td>
                  <button
                    nz-button
                    nzType="text"
                    class="view-button"
                    (click)="viewClientDetails(data)"
                  >
                    View
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </nz-table>
        </div>
      </div>
    </div>
  </nz-content>
</nz-layout>
