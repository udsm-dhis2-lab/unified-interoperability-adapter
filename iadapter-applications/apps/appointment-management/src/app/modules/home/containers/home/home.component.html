<nz-layout>
  <nz-content>
    <nz-breadcrumb class="breadcrumb">
      <nz-breadcrumb-item>
        <a [routerLink]="['/home']">Appointment Management</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/workflows']">Appointment</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>

    <div class="inner-content">
      <!-- Filter Row -->
      <!-- Filter Row -->
      <div nz-row [nzGutter]="16" style="padding: 16px">
        <!-- First Name Input -->
        <div nz-col [nzSpan]="4">
          <input
            nz-input
            placeholder="First Name"
            [(ngModel)]="firstName"
            class="sexy-input"
            (ngModelChange)="filterData($event, 'firstName')"
          />
        </div>

        <!-- Facility Search Inputs -->
        <div nz-col [nzSpan]="4">
          <input
            nz-input
            placeholder="Facility"
            [(ngModel)]="facilityFrom"
            (ngModelChange)="filterData($event, 'referringFacility')"
            class="sexy-input"
          />
        </div>

        <div nz-col [nzSpan]="4">
          <input
            nz-input
            placeholder="Appointment ID"
            [(ngModel)]="appointmentID"
            (ngModelChange)="filterData($event, 'appointmentID')"
            class="sexy-input"
          />
        </div>

        <div nz-col [nzSpan]="4">
          <input
            nz-input
            placeholder="Client ID"
            [(ngModel)]="clientId"
            (ngModelChange)="filterData($event, 'clientId')"
            class="sexy-input"
          />
        </div>

        <!-- Date Filters -->
        <!-- <div nz-col [nzSpan]="4">
          <nz-date-picker
            style="width: 100%; width: 100% !important"
            nzPlaceHolder="Start Date"
            [(ngModel)]="startDate"
            (ngModelChange)="filterData($event, 'startDate')"
            class="sexy-input"
          ></nz-date-picker>
        </div>
        <div nz-col [nzSpan]="4">
          <nz-date-picker
            style="width: 100%; width: 100% !important"
            nzPlaceHolder="End Date"
            [(ngModel)]="endDate"
            (ngModelChange)="filterData($event, 'endDate')"
            class="sexy-input"
          ></nz-date-picker>
        </div> -->

        <div nz-col [nzSpan]="4">

          <nz-select
            ngModel="gender"
            style="width: 100%"
            nzAllowClear
            nzPlaceHolder="Select a gender"
            (ngModelChange)="filterData($event, 'gender')"
          >
            <nz-option nzValue="male" nzLabel="Male"></nz-option>
            <nz-option nzValue="female" nzLabel="Female"></nz-option>
          </nz-select>
        </div>

        <!-- Apply Filters Button -->
        <div nz-col [nzSpan]="1.5">
          <button
            nz-button
            nzType="primary"
            (click)="applyFilters()"
            class="apply-button"
          >
            Search
          </button>
        </div>

        <div nz-col [nzSpan]="1">
          <button
            nz-button
            nzType="default"
            (click)="resetFilters()"
          >
            Reset
          </button>
        </div>
      </div>

      <!-- Table -->
      <div nz-row>
        <div style="padding: 0 16px 16px; width: 100%">
          <nz-table
            nzShowSizeChanger
            [nzData]="appointments"
            [nzFrontPagination]="false"
            [nzLoading]="loading"
            [nzTotal]="total"
            [nzPageSize]="pageSize"
            [nzPageIndex]="pageIndex"
            (nzQueryParams)="onQueryParamsChange($event)"
          >
            <thead>
              <tr>
                <th>SN</th>
                <th>Client ID</th>
                <th>First Name</th>
                <th>Middle Name</th>
                <th>Surname</th>
                <th>Gender</th>
                <th>Appointment Status</th>
                <th>Appointment ID</th>
                <th>Service Type</th>
                <th>Facility</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              @for (appointment of appointments; track appointment.patient_id; let i = $index) {
              <tr>
                <td>
                  {{
                    pageIndex === 1 ? i + 1 : (pageIndex - 1) * pageSize + i + 1
                  }}
                </td>
                <td>
                  <span style="color: #1890ff">{{ appointment.patient_id }}</span>
                </td>
                <td>{{ appointment.first_name }}</td>
                <td></td>
                <td>{{ appointment.surname }}</td>
                <td>{{ appointment.gender | titlecase }}</td>
                <td>
                  <nz-tag center [nzColor]="getStatusColor(appointment.appointment_status)">
                    {{ appointment.appointment_status | titlecase }}
                  </nz-tag>
                </td>
                <td>{{ appointment.appointment_id }}</td>
                <td>{{ appointment.service_type_name }}</td>
                <td>{{ appointment.referring_facility || '-' }}</td>
                <td>
                  <button
                    nz-button
                    nzType="text"
                    class="view-button"
                    (click)="viewClientDetails(appointment.patient_id)"
                  >
                    View
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </nz-table>
        </div>
      </div>
    </div>
  </nz-content>
</nz-layout>
